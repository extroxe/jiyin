app.controller("agentCtrl",["$scope","_jiyin","dataToURL","$filter",function(e,t,a){e.memberList={},e.inputPage=1,e.keyword="",e.start_time="",e.end_time="",e.role_id="",e.time={},e.register_start_time="",e.register_end_time="",e.upload=function(){$("#upload").modal("show")};var n="",i="";e.ok=function(){$("#upload").modal("hide")},e.$on("memberList",function(t,a){e.memberList=a}),e.$on("totalPage",function(t,a){e.totalPage=a}),e.synchronize=function(){return n=e.register_start_time,i=e.register_end_time,""==n||""==i?void t.msg("e","请输入开始时间和结束时间"):n>i?void t.msg("e","开始时间不能大于结束时间"):(e.inputPage=1,void t.dataPost("admin/erp_admin/synchronize_agent_from_erp/",a({start_time:n,end_time:i})).then(function(e){e.success?t.msg("s",e.msg):t.msg("e",e.msg)}))},e.search=function(){e.inputPage=1,e.getData()},$("#search").keydown(function(t){13==t.keyCode&&e.getData()}),e.getData=function(){t.dataPost("admin/user_admin/get_agents_page",a({page:e.inputPage,keyword:e.keyword,start_time:e.register_start_time,end_time:e.register_end_time})).then(function(a){a.success?e.memberList=a.data:(t.msg("e",a.msg),e.memberList=[]),e.totalPage=a.total_page,e.role_id=a.role_id})},e.getData(),e.addList=function(){e.title="增加数据",t.modal({tempUrl:"/source/admin/tpl/modal/modal-agentInfo.html",tempCtrl:"modalAgentCtrl",ok:e.add,size:"lg",params:{title:e.title,infoList:{},ael:"add"}})},e.add=function(n){t.dataPost("admin/user_admin/add_info",a(n)).then(function(a){1==a.success?(t.msg("s",a.msg),e.getData()):t.msg("e",a.error)})},e.editList=function(a){e.title="编辑数据",t.modal({tempUrl:"/source/admin/tpl/modal/modal-agentInfo.html",tempCtrl:"modalAgentCtrl",ok:e.edit,size:"lg",params:{title:e.title,infoList:a,ael:"edit"}})},e.edit=function(n){t.dataPost("admin/user_admin/update_agent_info",a(n)).then(function(a){1==a.success?(t.msg("s",a.msg),e.getData()):t.msg("e",a.error)})},e.changPasswdList=function(a){e.title="修改密码",t.modal({tempUrl:"/source/admin/tpl/modal/modal-agentChangePasswd.html",tempCtrl:"modalAgentChangePasswdCtrl",ok:e.changePasswd,size:"lg",params:{title:e.title,infoList:a,ael:"edit"}})},e.changePasswd=function(e){console.log(e),t.dataPost("admin/user_admin/update_agent_passwd",a(e)).then(function(a){1==a.success?t.msg("s",a.msg):t.msg("e",a.error),e.newPasswd="",e.rePasswd=""})},e.deleteData=function(n){confirm("确认删除这条数据吗?")&&t.dataPost("admin/user_admin/soft_delete",a({id:n.id})).then(function(a){1==a.success?(t.msg("s","删除成功"),e.getData()):t.msg("e",a.msg)})},e.nextPage=function(){e.inputPage<e.totalPage?(e.inputPage++,e.getData()):t.msg("e","当前是最后一页")},e.previousPage=function(){e.inputPage>1?(e.inputPage--,e.getData()):t.msg("e","当前是第一页")},e.firstPage=function(){e.inputPage=1,e.getData()},e.lastPage=function(){e.inputPage=e.totalPage,e.getData()},e.selectPage=function(t){e.inputPage=t,e.getData()}}]),app.controller("memberFileUploadCtrl",["$scope","FileUploader","_jiyin","dataToURL",function(e,t,a,n){var i=e.uploader=new t({url:SITE_URL+"admin/user_admin/batch_up_user_data"});i.filters.push({name:"customFilter",fn:function(){return this.queue.length<2}}),e.upload=function(e){return i.queue.length>1?void a.msg("e","只能上传一个文件"):void e.upload()},e.uploadAll=function(){return i.queue.length>1?void a.msg("e","只能上传一个文件"):void angular.forEach(i.queue,function(e){e.upload()})},i.onSuccessItem=function(t,i){if(1==i.success){if(a.msg("s",i.msg),i.error){var s="";angular.forEach(i.error,function(e){s=s+e+","}),alert(s)}a.dataPost("admin/user_admin/get_page_info/",n({page:1})).then(function(t){e.$emit("memberList",t.data),e.$emit("totalPage",t.total_page)})}else a.msg("e",i.msg)},e.$on("clearQueue",function(){i.clearQueue()})}]);