app.directive("autoFocus",function(){return function(e,t){t[0].focus()}}),app.controller("offLineOrderCtrl",["$rootScope","$scope","_jiyin","dataToURL","$stateParams","$state","$filter",function(e,t,i,a,s,d){t.is_admin=e.is_admin,t.orderList={},t.inputPage=1,t.pageSize=10,t.keyword="",t.role_id=30,t.off_line=1,t.list={},t.open=!1,t.check=!1,t.state=0,t.register_start_time="",t.register_end_time="",t.checkList=new Array,t.is_agents=["全部","是","否"],t.is_agent_id=0,t.is_agent="全部",t.totalPage=1,t.status=[],t.checkNum=0,t.allCheckNum=10,t.select_all=!1,t.select_one=!1,t.checkedArray=[],t.compress={},t.back=function(){window.history.go(-1)};var r="",n="";t.synchronize=function(){return r=t.register_start_time,n=t.register_end_time,""==r||""==n?void i.msg("e","请输入开始时间和结束时间"):r>n?void i.msg("e","开始时间不能大于结束时间"):(t.inputPage=1,void i.dataPost("admin/erp_admin/synchronize_order_from_erp/",a({start_time:r,end_time:n})).then(function(e){e.success?(t.getData(),i.msg("s",e.msg)):i.msg("e",e.msg)}))},t.synchronize_cancel=function(){return r=t.register_start_time,n=t.register_end_time,""==r||""==n?void i.msg("e","请输入开始时间和结束时间"):r>n?void i.msg("e","开始时间不能大于结束时间"):(t.inputPage=1,void i.dataPost("admin/erp_admin/synchronize_invalid_order_from_erp/",a({start_time:r,end_time:n})).then(function(e){e.success?(t.getData(),i.msg("s",e.msg)):i.msg("e",e.msg)}))},t.synchronize_sales_return=function(){return r=t.register_start_time,n=t.register_end_time,""==r||""==n?void i.msg("e","请输入开始时间和结束时间"):r>n?void i.msg("e","开始时间不能大于结束时间"):(t.inputPage=1,void i.dataPost("admin/erp_admin/synchronize_sales_return_from_erp/",a({start_time:r,end_time:n})).then(function(e){e.success?(t.getData(),i.msg("s",e.msg)):i.msg("e",e.msg)}))},t.select_all=!1,t.selectAll=function(){if(t.select_all=!t.select_all,t.select_all)angular.forEach(t.orderList,function(e){t.checkedArray.indexOf(e.id)<0&&t.checkedArray.push(e.id),e.checked=!0});else{for(var e=0;e<t.orderList.length;e++)t.checkedArray.indexOf(t.orderList[e].id)>=0&&(t.checkedArray.splice(t.checkedArray.indexOf(t.orderList[e].id),1),e--);angular.forEach(t.orderList,function(e){e.checked=!1})}},t.selectOne=function(e){angular.forEach(t.orderList,function(i){var a=t.checkedArray.indexOf(e);-1===a&&i.checked&&e==i.id?t.checkedArray.push(i.id):-1===a||i.checked||e!=i.id||t.checkedArray.splice(a,1)}),t.select_all=t.orderList.length===t.checkedArray.length},t.stateIsAgent=function(e){angular.forEach(t.is_agents,function(i,a){e==a&&(t.is_agent=i,t.is_agent_id=e)})},t.listcheck=function(){t.checkNum=0,angular.forEach(t.orderList,function(e){e.checked&&t.checkNum++})},t.getData=function(){i.dataPost("admin/order_admin/paginate/"+t.inputPage+"/"+t.pageSize,a({is_point:0,keyword:t.keyword,start_create_time:t.register_start_time,end_create_time:t.register_end_time,order_status:t.state,is_agent:t.is_agent_id,off_line:t.off_line})).then(function(e){if(e.success){if(t.orderList=e.data,t.role_id=e.role_id,t.tempReportList=[],t.orderList)for(var a=0;a<t.orderList.length;a++)t.orderList[a].sub_order.length>2?(t.tempReportList[a]=t.orderList[a].sub_order.slice(2,t.orderList[a].sub_order.length),t.orderList[a].sub_order=t.orderList[a].sub_order.slice(0,2)):t.tempReportList[a]=[];t.allCheckNum=t.orderList.length;var s=0;angular.forEach(t.orderList,function(e){return-1!=t.checkedArray.indexOf(e.id)?(e.checked=!0,void s++):void(e.checked=!1)}),t.select_all=s===t.orderList.length}else t.orderList=[],t.select_all=!1,i.msg("e",e.msg);t.totalPage=e.total_page,t.totalCount=e.total_count})},t.getData(),$("#search").keydown(function(e){13==e.keyCode&&t.getData()}),t.search=function(){t.getData()},t.searchOrderByStatus=function(e){t.state=e,t.getData()},i.dataGet("admin/order_admin/get_all_order_status").then(function(e){e.success&&(t.status=e.data)}),i.dataGet("admin/express_admin/get_all_express_company").then(function(e){e.success&&(t.compress=e.data)}),t.download=function(){if(t.checkedArray.length<=0)return void i.msg("e","请选择需要导出订单");var e="?";0!=t.checkedArray.length&&(e+="&order_id="+t.checkedArray.join("_")),e+="&is_online=2",window.open(SITE_URL+"admin/order_admin/download_order"+e)},t.exinfo=function(e){i.dataGet("admin/order_admin/show_express_info_by_order_id/"+e.id).then(function(e){1==e.success?($("#list").modal("show"),t.exinfo=e.data.Traces):i.msg("e",e.msg)})},t.cancel=function(e){$(e).modal("hide")},t.push_report=function(e){for(var i=0;i<t.tempReportList[e].length;i++)t.orderList[e].sub_order.push(t.tempReportList[e][i])},t.shift_report=function(e){for(var i=0;i<t.tempReportList[e].length;i++)t.orderList[e].sub_order=t.orderList[e].sub_order.slice(0,2)},t.editList=function(e){t.title="编辑数据",i.modal({tempUrl:"/source/admin/tpl/modal/modal-orderList.html",tempCtrl:"modalOrderCtrl",ok:t.edit,size:"lg",params:{title:t.title,infoList:e,ael:"edit",isPoint:!1}})},t.edit=function(e){i.dataPost("admin/order_admin/update",a(e)).then(function(e){1==e.success?(i.msg("s",e.msg),t.getData()):i.msg("e",e.msg)})},t.lookSub=function(e){d.go("app.subOrderList",{id:e.id,type:"ord"})},$(document).on("click","#operation li",function(){$(this).addClass("active").siblings().removeClass("active")}),t.getOrderDetailModal=function(e){t.order_status_id=e.status_id,t.notPaidValue=0,t.paidValue=0,t.deliveredValue=0,t.sentbackValue=0,t.assayingValue=0,$("#orderDetail").modal("show"),$("#closeOrderDetail").show(),$("#printBtn").show(),$("#order_footer").show(),t.orderDetail=angular.copy(e),setTimeout(function(){t.$apply(function(){"10"==e.status_id||"20"==e.status_id?($("div.not_paid").find(".node").addClass("active").siblings("div").find(".node").removeClass("active"),$("div.not_paid").siblings("div").find(".node").removeClass("active"),t.notPaidValue=50):"30"==e.status_id?($("div.delivered").find(".node").addClass("active").siblings("div").find(".node").removeClass("active").prevAll(".node").addClass("active"),$("div.delivered").siblings("div").find(".node").removeClass("active"),$("div.delivered").prevAll("div").find(".node").addClass("active"),t.notPaidValue=100,t.paidValue=100,t.deliveredValue=50):"40"==e.status_id?($("div.sentback").find(".node").addClass("active").siblings("div").find(".node").removeClass("active").prevAll(".node").addClass("active"),$("div.sentback").siblings("div").find(".node").removeClass("active"),$("div.sentback").prevAll("div").find(".node").addClass("active"),t.notPaidValue=100,t.paidValue=100,t.deliveredValue=100,t.sentbackValue=50):"50"==e.status_id?($("div.assaying").find(".node").eq(0).addClass("active").siblings("div").find(".node").removeClass("active").prevAll(".node").addClass("active"),$("div.assaying").siblings("div").find(".node").removeClass("active"),$("div.assaying").prevAll("div").find(".node").addClass("active"),t.notPaidValue=100,t.paidValue=100,t.deliveredValue=100,t.sentbackValue=100,t.assayingValue=50):($("div.order-progress").find(".node").addClass("active"),t.notPaidValue=100,t.paidValue=100,t.deliveredValue=100,t.sentbackValue=100,t.assayingValue=100)})},300)},t.Jprintf=function(){$("#closeOrderDetail").hide(),$("#printBtn").hide(),$("#order_footer").hide(),$("#orderDetail").jqprint({importCSS:!0}),setTimeout(function(){$("#closeOrderDetail").show(),$("#printBtn").show(),$("#order_footer").show()},1e3)},t.modifyAmountModal=function(){$("#modifyAmount").modal("show")},t.delivery=function(){$("#deliverOrder").modal("show")},t.nextPage=function(){t.inputPage<t.totalPage?(t.check=!1,t.inputPage++,t.getData()):i.msg("e","当前是最后一页")},t.previousPage=function(){t.inputPage>1?(t.check=!1,t.inputPage--,t.getData()):i.msg("e","当前是第一页")},t.firstPage=function(){1==t.totalPage?i.msg("e","当前是第一页"):(t.check=!1,t.inputPage=1,t.getData())},t.lastPage=function(){1==t.totalPage?i.msg("e","当前是最后一页"):(t.check=!1,t.inputPage=t.totalPage,t.getData())},t.selectPage=function(e){1==t.totalPage?i.msg("e","当前是最后一页"):(t.check=!1,t.inputPage=e,t.getData())}}]);