"use strict";app.controller("modalBannerCtrl",["$rootScope","$scope","$modalInstance","_jiyin","params","FileUploader","dataToURL",function(t,i,e,n,o,a,s){i.is_admin=t.is_admin,i.infoList=angular.copy(o.infoList),i.title=o.title,i.ael=o.ael,i.$watch("currentUser.role_id",function(e){"30"==e&&(i.infoList.position_id="6",i.infoList.agent_name=t.currentUser.username,i.infoList.agent_id=t.currentUser.id)}),i.getPosition=function(){n.dataPost("admin/system_code_admin/get_by_type/banner_position").then(function(t){i.positionList=t})},i.getPosition(),i.getAgent=function(){i.title="添加代理商",n.modal({tempUrl:"/source/admin/tpl/modal/modal-agentAddCommodity.html",tempCtrl:"agentAddCommodityCtrl",ok:i.addAgent,size:"lg",params:{title:i.title,ael:"add"}})},i.addAgent=function(t){i.infoList.agent_name=t.name,i.infoList.agent_id=t.id},i.removePic=function(t){comfirm("确定删除该图片吗?")&&n.dataPost("",s({id:t})).then(function(t){if(t.success)for(var e=i.rowData.pic,n=0;n<e.length;n++)picId===e[n].id&&i.rowData.pic.splice(n,1)})},i.$on("attachment_id",function(t,e){i.infoList.attachment_id=e}),i.$on("attachment_path",function(t,e){i.infoList.path=e}),i.cancel=function(){e.dismiss("cancel")},i.ok=function(){return i.infoList.position_id?"6"!=i.infoList.position_id||i.infoList.agent_id&&""!=i.infoList.agent_id&&null!=i.infoList.agent_id?i.infoList.attachment_id?void e.close(i.infoList):void n.msg("e","还没有上传图片"):void n.msg("e","请添加代理商"):void n.msg("e","位置不能为空")}}]),app.controller("FileUploadCtrl",["$scope","FileUploader","_jiyin","dataToURL",function(t,i,e,n){var o=t.uploader=new i({url:SITE_URL+"attachment/up_attachment"});o.filters.push({name:"customFilter",fn:function(){return this.queue.length<1}}),t.upload=function(i){e.fileMd5(i._file).then(function(a){e.dataPost("attachment/check_md5",n({md5_code:a.md5Code})).then(function(e){1==e.exist?(t.$emit("attachment_id",e.attachment_id),t.$emit("attachment_path",e.path),i.file.size=i._file.size,i.progress=100,i.isSuccess=!0,i.isUploaded=!0,i.uploader.progress+=100/o.queue.length):i.upload()})})},t.uploadAll=function(){angular.forEach(o.queue,function(i){e.fileMd5(i._file).then(function(a){e.dataPost("attachment/check_md5",n({md5_code:a.md5Code})).then(function(e){1==e.exist?(t.$emit("attachment_id",e.attachment_id),i.file.size=i._file.size,i.progress=100,i.isSuccess=!0,i.isUploaded=!0,o.progress+=100/o.queue.length,o.clearQueue()):i.upload()})})})},o.onSuccessItem=function(i,e){t.$emit("attachment_id",e.attachment_id),t.$emit("attachment_path",e.url)},t.$on("clearQueue",function(){o.clearQueue()})}]);