"use strict";app.controller("modalUserCtrl",["$scope","$modalInstance","_jiyin","params","FileUploader","dataToURL",function(t,e,i,o){t.infoList=o.infoList,t.title=o.title,t.role_id=o.role_id,t.ael=o.ael,setTimeout(function(){$("#color").val(t.infoList.color)},200),t.infoList.is_show&&(t.showFlag=t.infoList.is_show=!0),t.getRole=function(){i.dataPost("admin/system_code_admin/get_by_type/role").then(function(e){t.roleList=e})},t.getRole(),t.$watch("ael",function(t){t&&setTimeout(function(){$("#colorpicker").farbtastic("#color"),$("#color").focus(function(){$("#colorpicker").show()}),$("#color").blur(function(){$("#colorpicker").hide()})},1e3)}),setTimeout(function(){$("#color").val(t.infoList.color)},200),t.getLevel=function(){i.dataPost("admin/level_admin/get_level").then(function(e){t.levelList=e.data})},t.getLevel(),t.$on("attachment_id",function(e,i){t.infoList.attachment_id=i}),t.cancel=function(){e.dismiss("cancel")},t.ok=function(){if(t.infoList.birthday=$(".user-birthday").val(),t.infoList.color=30==t.infoList.role_id?$("#color").val():"",!t.infoList.password)return void i.msg("e","密码不能为空");if(!t.infoList.username)return void i.msg("e","用户名不能为空");if(!t.infoList.phone)return void i.msg("e","电话号码不能为空");if(!t.infoList.current_point)return void i.msg("e","当前积分不能为空");if(!t.infoList.total_point)return void i.msg("e","总积分不能为空");if(!t.infoList.role_id)return void i.msg("e","角色不能为空");t.infoList.is_show=1;var o=/^1(3|4|5|7|8)\d{9}$/,n=/^\w+@\w+\..+$/;return t.infoList.phone&&0==o.test(t.infoList.phone)?void i.msg("e","手机号不符合规则"):t.infoList.email&&0==n.test(t.infoList.email)?void i.msg("e","邮箱不符合规则"):void e.close(t.infoList)}}]),app.controller("FileUploadCtrl",["$scope","FileUploader","_jiyin","dataToURL",function(t,e,i,o){var n=t.uploader=new e({url:SITE_URL+"attachment/up_attachment"});n.filters.push({name:"customFilter",fn:function(){return this.queue.length<2}}),t.upload=function(e){i.fileMd5(e._file).then(function(s){i.dataPost("attachment/check_md5",o({md5_code:s.md5Code})).then(function(i){1==i.exist?(t.$emit("attachment_id",i.attachment_id),e.file.size=e._file.size,e.progress=100,e.isSuccess=!0,e.isUploaded=!0,e.uploader.progress+=100/n.queue.length):e.upload()})})},t.uploadAll=function(){angular.forEach(n.queue,function(e){i.fileMd5(e._file).then(function(s){i.dataPost("attachment/check_md5",o({md5_code:s.md5Code})).then(function(i){1==i.exist?(t.$emit("attachment_id",i.attachment_id),e.file.size=e._file.size,e.progress=100,e.isSuccess=!0,e.isUploaded=!0,n.progress+=100/n.queue.length):e.upload()})})})},n.onSuccessItem=function(e,i){t.$emit("attachment_id",i.attachment_id)},t.$on("clearQueue",function(){n.clearQueue()})}]);