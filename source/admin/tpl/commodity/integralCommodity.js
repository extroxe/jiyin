app.controller("integralCtrl",["$scope","_jiyin","dataToURL","$stateParams","$state",function(t,e,i,a,n){t.integralList={},t.list={},t.inputPage=1,t.isPoint=!0,t.picList=[],t.keyword="",t.urlPC="",t.urlWC="",t.open=!1,t.specification=function(t){n.go("app.specification",{commodity_id:t.id,type:"int"})},t.lookEva=function(t){n.go("app.evaluate",{commodity_id:t.id,type:"int"})},t.getData=function(){e.dataPost("admin/commodity_admin/paginate/"+t.inputPage+"/10",i({keyword:t.keyword,is_point:1,agent_id:"admin"})).then(function(i){i.success?(t.integralList=i.data,t.totalPage=i.total_page):(t.inputPage=1,t.totalPage=1,e.msg("e",i.msg))})},t.getData(),$("#search").keydown(function(e){13==e.keyCode&&t.getData()}),t.show=function(){t.title="增加",t.ael="add",t.list={},t.url=!1,t.getThumbnail(),t.getType(),t.getCate(),t.getLevel(),t.open=!0,t.$broadcast("open",{open:t.open}),$("#add").modal("show")},t.edit=function(e){t.title="编辑",t.ael="edit",t.url=!0,t.urlPC=SITE_URL+"/commodity/index/"+e.id,t.urlWC=SITE_URL+"/weixin/index/commodity_detail/"+e.id,t.list=e,t.getThumbnail(),t.getType(),t.getCate(),t.getLevel(),t.open=!0,t.$broadcast("open",{open:t.open}),$("#add").modal("show")},t.getThumbnail=function(){t.list.id&&e.dataPost("admin/commodity_admin/show_thumbnail",i({commodity_id:t.list.id})).then(function(e){t.picList=e.data})},t.getType=function(){t.typeList=[],e.dataPost("admin/system_code_admin/get_by_type/commodity_type").then(function(e){e&&angular.forEach(e,function(e){"1"!=e.value&&t.typeList.push(e)})})},t.getLevel=function(){e.dataGet("admin/level_admin/get_level").then(function(i){i.success?t.levelList=i.data:(t.levelList=[],e.msg("e",i.msg))})},t.getCate=function(){e.dataPost("admin/category_admin/get_categories").then(function(i){i.success?t.cateList=i.data:(t.cateList=[],e.msg("e",i.msg))})},t.$on("attachment_ids",function(e,i){t.list.attachment_ids||(t.list.attachment_ids=[]),t.list.attachment_ids.push(i)}),t.$on("path",function(e,i){null==t.picList&&(t.picList=[]);var a=[];a.path=i,t.picList.push(a)}),t.removePic=function(a,n){confirm("确定删除该图片吗?")&&(a?e.dataPost("admin/commodity_admin/delete_thumbnail",i({id:a})).then(function(){t.picList.splice(n,1),t.getThumbnail()}):t.picList.splice(n,1))},t.ok=function(){return t.list.name?t.list.number?t.list.category_id?t.list.type_id?t.list.detail?void("add"==t.ael?(t.list.is_point=1,e.dataPost("admin/commodity_admin/add",i(t.list)).then(function(i){1==i.success?(e.msg("s","添加成功"),t.getData(),$("#add").modal("hide")):e.msg("e",i.msg)})):e.dataPost("admin/commodity_admin/update",i(t.list)).then(function(i){1==i.success?(e.msg("s","修改成功"),t.getData(),$("#add").modal("hide")):e.msg("e",i.msg)})):void e.msg("e","商品详情不能为空"):void e.msg("e","商品类型不能为空"):void e.msg("e","商品分类不能为空"):void e.msg("e","商品编号不能为空"):void e.msg("e","商品名称不能为空")},t.deleteData=function(a){confirm("确认删除这条数据吗?")&&e.dataPost("admin/commodity_admin/delete",i({id:a.id})).then(function(i){1==i.success?(e.msg("s","删除成功"),t.getData()):e.msg("e",i.msg)})},t.nextPage=function(){t.inputPage<t.totalPage?(t.inputPage++,t.getData()):e.msg("e","当前是最后一页")},t.previousPage=function(){t.inputPage>1?(t.inputPage--,t.getData()):e.msg("e","当前是第一页")},t.firstPage=function(){t.inputPage=1,t.getData()},t.lastPage=function(){t.inputPage=t.totalPage,t.getData()},t.selectPage=function(e){t.inputPage=e,t.getData()}}]),app.controller("intFileUploadCtrl",["$scope","FileUploader","_jiyin","dataToURL",function(t,e,i,a){t.attachment_ids=[];var n=t.uploader=new e({url:SITE_URL+"attachment/up_attachment",removeAfterUpload:!0,queueLimit:5});t.$on("open",function(t,e){1==e.open&&n.clearQueue()}),n.filters.push({name:"customFilter",fn:function(){return this.queue.length<6}}),t.upload=function(e){i.fileMd5(e._file).then(function(o){i.dataPost("attachment/check_md5",a({md5_code:o.md5Code})).then(function(i){1==i.exist?(t.attachment_ids=[],t.attachment_ids.push(i.attachment_id),t.$emit("attachment_ids",t.attachment_ids),t.$emit("path",i.path),e.file.size=e._file.size,e.progress=100,e.isSuccess=!0,e.isUploaded=!0,e.uploader.progress+=100/n.queue.length):e.upload()})})},t.uploadAll=function(){angular.forEach(n.queue,function(e){i.fileMd5(e._file).then(function(o){i.dataPost("attachment/check_md5",a({md5_code:o.md5Code})).then(function(i){1==i.exist?(t.attachment_ids=[],t.attachment_ids.push(i.attachment_id),t.$emit("attachment_ids",t.attachment_ids),t.$emit("path",i.path),e.file.size=e._file.size,e.progress=100,e.isSuccess=!0,e.isUploaded=!0,n.progress+=100/n.queue.length):e.upload()})})})},n.onSuccessItem=function(e,i){t.attachment_ids=[],t.attachment_ids.push(i.attachment_id),t.$emit("attachment_ids",t.attachment_ids),t.$emit("path",i.url)},t.$on("clearQueue",function(){n.clearQueue()})}]);