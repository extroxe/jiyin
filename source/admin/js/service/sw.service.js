app.factory("dataToURL",function(){return function(e){if(e instanceof Object)for(var t in e)e.hasOwnProperty(t)&&("undefined"==typeof e[t]||!e[t]&&"undefined"!=typeof e[t]&&0!=e[t])&&(e[t]="");var n="";for(var o in e)n+="&"+o+"="+encodeURIComponent(e[o]);return n.slice(1,n.length)}}),app.factory("_jiyin",["$http","$q","toaster","$modal","$rootScope",function(e,t,n,o,r){var i={};i.fileMd5=function(e){var n=t.defer(),o=new FileReader,r=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,i=2097152,a=Math.ceil(e.size/i),s=0,d=new SparkMD5;o.onload=function(t){if(d.appendBinary(t.target.result),s++,a>s)c();else{var o=d.end();n.resolve({md5Code:o,file:e})}};var c=function(){var t=s*i,n=t+i>=e.size?e.size:t+i;o.readAsBinaryString(r.call(e,t,n))};return c(),n.promise},i.msg=function(e,t){var o={s:"success",i:"info",wt:"wait",w:"warning",e:"error"}[e];o=o?o:"success",t=t||"",n.pop(o,"信息提示",t)};var a=0,s=0;return i.dataGet=function(n,o){r.isLoading=!0,a++;var d=t.defer();return e({method:"GET",contentType:"application/json",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;","X-Requested-With":"XMLHttpRequest"},dataType:"json",data:o,url:SITE_URL+n}).success(function(e){a--,0==a&&0==s&&r.isLoading&&(r.isLoading=!1),e.timeout&&(i.msg("e",e.msg),window.location.href=SITE_URL+"admin/admin"),d.resolve(e)}).error(function(){s--,0==a&&0==s&&r.isLoading&&(r.isLoading=!1,i.msg("e","系统繁忙，请稍后重试")),d.reject("Error!")}),d.promise},i.dataPost=function(n,o){s++,r.isLoading=!0;var d=t.defer();return e({method:"POST",contentType:"application/json",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;","X-Requested-With":"XMLHttpRequest"},dataType:"json",data:o,url:SITE_URL+n}).success(function(e){s--,0==a&&0==s&&r.isLoading&&(r.isLoading=!1),e.timeout&&(i.msg("e",e.msg),window.location.href=SITE_URL+"admin/admin"),d.resolve(e)}).error(function(){s--,0==a&&0==s&&r.isLoading&&(r.isLoading=!1,i.msg("e","系统繁忙，请稍后重试")),d.reject("Error!")}),d.promise},i.modal=function(e){var t=e.type,n=e.size||"",r="",i="";if(void 0==t&&void 0!=e.tempUrl&&(r=e.tempUrl,i=e.tempCtrl),""==r||""==i)return void this.msg("e","未指定模板文件！");var a=o.open({templateUrl:r,controller:i,size:n,resolve:{params:function(){return e.params}}});a.result.then(e.ok,e.cancle)},i}]);